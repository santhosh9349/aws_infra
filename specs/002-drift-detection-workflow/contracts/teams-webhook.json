{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TeamsWebhookPayload",
  "description": "Microsoft Teams Incoming Webhook payload for Terraform drift notifications using Adaptive Cards",
  "type": "object",
  "required": ["type", "attachments"],
  "properties": {
    "type": {
      "type": "string",
      "const": "message"
    },
    "attachments": {
      "type": "array",
      "minItems": 1,
      "maxItems": 1,
      "items": {
        "type": "object",
        "required": ["contentType", "content"],
        "properties": {
          "contentType": {
            "type": "string",
            "const": "application/vnd.microsoft.card.adaptive"
          },
          "contentUrl": {
            "type": "null"
          },
          "content": {
            "$ref": "#/definitions/AdaptiveCard"
          }
        }
      }
    }
  },
  "definitions": {
    "AdaptiveCard": {
      "type": "object",
      "required": ["$schema", "type", "version", "body"],
      "properties": {
        "$schema": {
          "type": "string",
          "const": "http://adaptivecards.io/schemas/adaptive-card.json"
        },
        "type": {
          "type": "string",
          "const": "AdaptiveCard"
        },
        "version": {
          "type": "string",
          "const": "1.4"
        },
        "body": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/TextBlock" },
              { "$ref": "#/definitions/FactSet" },
              { "$ref": "#/definitions/Container" }
            ]
          }
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ActionOpenUrl"
          }
        }
      }
    },
    "TextBlock": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": {
          "type": "string",
          "const": "TextBlock"
        },
        "text": {
          "type": "string",
          "maxLength": 1000
        },
        "weight": {
          "type": "string",
          "enum": ["default", "lighter", "bolder"]
        },
        "size": {
          "type": "string",
          "enum": ["default", "small", "medium", "large", "extraLarge"]
        },
        "color": {
          "type": "string",
          "enum": ["default", "dark", "light", "accent", "good", "warning", "attention"]
        },
        "wrap": {
          "type": "boolean"
        },
        "isSubtle": {
          "type": "boolean"
        }
      }
    },
    "FactSet": {
      "type": "object",
      "required": ["type", "facts"],
      "properties": {
        "type": {
          "type": "string",
          "const": "FactSet"
        },
        "facts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["title", "value"],
            "properties": {
              "title": {
                "type": "string",
                "maxLength": 100
              },
              "value": {
                "type": "string",
                "maxLength": 200
              }
            }
          }
        }
      }
    },
    "Container": {
      "type": "object",
      "required": ["type", "items"],
      "properties": {
        "type": {
          "type": "string",
          "const": "Container"
        },
        "items": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/TextBlock" },
              { "$ref": "#/definitions/FactSet" }
            ]
          }
        },
        "style": {
          "type": "string",
          "enum": ["default", "emphasis", "good", "attention", "warning", "accent"]
        }
      }
    },
    "ActionOpenUrl": {
      "type": "object",
      "required": ["type", "title", "url"],
      "properties": {
        "type": {
          "type": "string",
          "const": "Action.OpenUrl"
        },
        "title": {
          "type": "string",
          "maxLength": 50
        },
        "url": {
          "type": "string",
          "format": "uri"
        }
      }
    }
  },
  "examples": [
    {
      "type": "message",
      "attachments": [
        {
          "contentType": "application/vnd.microsoft.card.adaptive",
          "contentUrl": null,
          "content": {
            "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
            "type": "AdaptiveCard",
            "version": "1.4",
            "body": [
              {
                "type": "TextBlock",
                "text": "ðŸ”´ Terraform Drift Detected",
                "weight": "bolder",
                "size": "large",
                "color": "attention"
              },
              {
                "type": "FactSet",
                "facts": [
                  { "title": "Environment:", "value": "dev" },
                  { "title": "Resources Changed:", "value": "3" },
                  { "title": "Detected At:", "value": "2026-01-28 09:00 UTC" }
                ]
              },
              {
                "type": "TextBlock",
                "text": "**Changed Resources:**",
                "weight": "bolder"
              },
              {
                "type": "TextBlock",
                "text": "â€¢ `module.vpc.aws_vpc.main` - update\nâ€¢ `aws_subnet.public[0]` - delete\nâ€¢ `aws_security_group.web` - update",
                "wrap": true
              },
              {
                "type": "TextBlock",
                "text": "**Modified By:** arn:aws:iam::123456789012:user/admin",
                "isSubtle": true,
                "wrap": true
              }
            ],
            "actions": [
              {
                "type": "Action.OpenUrl",
                "title": "ðŸ“‹ View GitHub Issue",
                "url": "https://github.com/owner/aws_infra/issues/42"
              },
              {
                "type": "Action.OpenUrl",
                "title": "ðŸ”„ View Workflow Run",
                "url": "https://github.com/owner/aws_infra/actions/runs/12345678"
              }
            ]
          }
        }
      ]
    }
  ]
}
